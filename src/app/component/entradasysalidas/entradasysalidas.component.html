<div class="d-flex">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Contenido principal -->
  <div class="container mt-5">
    <div class="card shadow-lg">
      <div class="card-header bg-dark text-white text-center">
        <h2>Gestión de Entradas y Salidas</h2>
      </div>

      <div class="card-body">
        <!-- Formulario de movimientos -->
        <form [formGroup]="movimientoForm" (ngSubmit)="onSubmit()">
          <input type="hidden" id="IdMovimiento" formControlName="IdMovimiento" />

          <div class="row">
            <!-- Selección de Producto -->
            <div class="col-md-6 mb-3">
              <label for="IdProducto" class="form-label fw-bold">Producto</label>
              <select id="IdProducto" class="form-select" formControlName="IdProducto" required>
                <option value="" disabled selected>Seleccione un producto</option>
                <option *ngFor="let prod of productos" [value]="prod.idProducto">
                  {{ prod.nomProducto }} (Stock: {{ prod.cantidad }})
                </option>
              </select>
              <div *ngIf="f['IdProducto'].touched && f['IdProducto'].invalid" class="text-danger small">
                Debe seleccionar un producto.
              </div>
            </div>

            <!-- Tipo de Movimiento -->
            <div class="col-md-6 mb-3">
              <label for="TipoMovimiento" class="form-label fw-bold">Tipo de Movimiento</label>
              <select id="TipoMovimiento" class="form-select" formControlName="TipoMovimiento" required>
                <option value="" disabled selected>Seleccione</option>
                <option value="entrada">Entrada</option>
                <option value="salida">Salida</option>
              </select>
              <div *ngIf="f['TipoMovimiento'].touched && f['TipoMovimiento'].invalid" class="text-danger small">
                El tipo de movimiento es obligatorio.
              </div>
            </div>
          </div>

          <div class="row">
            <!-- Cantidad -->
            <div class="col-md-6 mb-3">
              <label for="Cantidad" class="form-label fw-bold">Cantidad</label>
              <input
                type="number"
                id="Cantidad"
                class="form-control"
                formControlName="Cantidad"
                placeholder="Ingrese la cantidad"
                required
              />
              <div *ngIf="f['Cantidad'].touched && f['Cantidad'].invalid" class="text-danger small">
                La cantidad debe ser al menos 1.
              </div>
            </div>

            <!-- Observación -->
            <div class="col-md-6 mb-3">
              <label for="Observacion" class="form-label fw-bold">Observación</label>
              <input
                type="text"
                id="Observacion"
                class="form-control"
                formControlName="Observacion"
                placeholder="Ingrese una observación"
              />
            </div>
          </div>

          <!-- Botón de envío -->
          <div class="row">
            <div class="col-5 mt-3 mx-auto">
              <button type="submit" class="btn btn-primary w-100" [disabled]="!movimientoForm.valid">
                <i class="fas fa-exchange-alt me-2"></i>
                {{ f['IdMovimiento'].value ? 'Actualizar Movimiento' : 'Registrar Movimiento' }}
              </button>
            </div>
          </div>
        </form>

        <!-- Tabla de entradas y salidas -->
        <div class="row">
          <app-tabla-entradas-salidas
            class="mt-4"
            [movimientos]="movimientos"
            (editarMovimiento)="llenarCamposFormulario($event.idMovimiento!)"
           (eliminarMovimiento)="onEliminar($event.idMovimiento)">
          </app-tabla-entradas-salidas>
        </div>
      </div>
    </div>
  </div>
</div>
